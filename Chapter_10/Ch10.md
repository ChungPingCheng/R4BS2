第十章: 潛在成長模型分析
================
2024 二月 23

``` r
#整體設定，含載入套件
source("https://raw.githubusercontent.com/ChungPingCheng/R4BS2/main/R4BS_setup.R")
```

# 資料與管理

``` r
#讀取檔案
dta <- read.csv('../Data/KIT_memory.csv', 
                header=T, stringsAsFactors = TRUE)
```

``` r
#看資料結構
#程式報表10.1
dim(dta)
```

    [1] 2000    7

``` r
#檢視資料格式與前六筆
head(dta)
```

<table>
<thead>
<tr>
<th style="text-align:left;">
識別碼
</th>
<th style="text-align:left;">
母親教育程度
</th>
<th style="text-align:right;">
月_03
</th>
<th style="text-align:right;">
月_06
</th>
<th style="text-align:right;">
月_12
</th>
<th style="text-align:right;">
月_18
</th>
<th style="text-align:right;">
月_24
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
53
</td>
</tr>
<tr>
<td style="text-align:left;">
S1002
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
59
</td>
</tr>
<tr>
<td style="text-align:left;">
S1003
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
S1004
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
59
</td>
</tr>
<tr>
<td style="text-align:left;">
S1005
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:left;">
S1006
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
57
</td>
</tr>
</tbody>
</table>

``` r
#寬資料轉成長資料
#也另外製造「月」，以及將月置中的「月置中」變項
dtaL <- dta |> 
  tidyr::pivot_longer(cols=3:7,
                      names_to ='月齡',  
                      values_to = '記憶分數') |>
  dplyr::mutate(月 = parse_number(月齡), 
                月置中 = scale(月, scale = F)[,1])
```

``` r
#程式報表10.2
head(dtaL)
```

<table>
<thead>
<tr>
<th style="text-align:left;">
識別碼
</th>
<th style="text-align:left;">
母親教育程度
</th>
<th style="text-align:left;">
月齡
</th>
<th style="text-align:right;">
記憶分數
</th>
<th style="text-align:right;">
月
</th>
<th style="text-align:right;">
月置中
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-9.6
</td>
</tr>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
-6.6
</td>
</tr>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
-0.6
</td>
</tr>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
5.4
</td>
</tr>
<tr>
<td style="text-align:left;">
S1001
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
11.4
</td>
</tr>
<tr>
<td style="text-align:left;">
S1002
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
-9.6
</td>
</tr>
</tbody>
</table>

``` r
#看五波的平均數與變異數，母親教育程度的影響在月齡較大時顯現
#程式報表10.3
dtaL |> 
  tidyr::unite("月齡母親教育程度", 月齡, 母親教育程度) |>
  dplyr::select("月齡母親教育程度", "記憶分數") |>
  gtsummary::tbl_summary(by=月齡母親教育程度,
            digits=list(記憶分數 ~ c(1, 2)),
            type = all_continuous() ~ "continuous2",
            statistic = list(all_continuous() ~ "{mean} ({sd})")) |>                          
  modify_header(label ~ "**變項**") 
```

``` r
#看看偏態與峰度
#程式報表10.4前
dtaL |> 
  dplyr::group_by(月齡, 母親教育程度) |>
  dplyr::reframe(平均 = mean(記憶分數),
                 標準差 = sd(記憶分數),
                 偏度 = moments::skewness(記憶分數),
                 峰度 = moments::kurtosis(記憶分數))
```

<table>
<thead>
<tr>
<th style="text-align:left;">
月齡
</th>
<th style="text-align:left;">
母親教育程度
</th>
<th style="text-align:right;">
平均
</th>
<th style="text-align:right;">
標準差
</th>
<th style="text-align:right;">
偏度
</th>
<th style="text-align:right;">
峰度
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
20.43
</td>
<td style="text-align:right;">
2.707
</td>
<td style="text-align:right;">
0.7297
</td>
<td style="text-align:right;">
3.019
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
20.39
</td>
<td style="text-align:right;">
2.752
</td>
<td style="text-align:right;">
0.9074
</td>
<td style="text-align:right;">
3.579
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
25.41
</td>
<td style="text-align:right;">
3.014
</td>
<td style="text-align:right;">
-0.1002
</td>
<td style="text-align:right;">
2.597
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
25.42
</td>
<td style="text-align:right;">
3.133
</td>
<td style="text-align:right;">
-0.1345
</td>
<td style="text-align:right;">
2.617
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
41.91
</td>
<td style="text-align:right;">
4.901
</td>
<td style="text-align:right;">
-0.6666
</td>
<td style="text-align:right;">
3.220
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
41.12
</td>
<td style="text-align:right;">
5.481
</td>
<td style="text-align:right;">
-0.5547
</td>
<td style="text-align:right;">
4.134
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
48.66
</td>
<td style="text-align:right;">
4.132
</td>
<td style="text-align:right;">
-0.1591
</td>
<td style="text-align:right;">
4.933
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
47.21
</td>
<td style="text-align:right;">
4.565
</td>
<td style="text-align:right;">
-1.0957
</td>
<td style="text-align:right;">
9.287
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
大學以上
</td>
<td style="text-align:right;">
55.86
</td>
<td style="text-align:right;">
5.797
</td>
<td style="text-align:right;">
0.1587
</td>
<td style="text-align:right;">
2.332
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
專科以下
</td>
<td style="text-align:right;">
52.71
</td>
<td style="text-align:right;">
5.772
</td>
<td style="text-align:right;">
-0.1325
</td>
<td style="text-align:right;">
5.485
</td>
</tr>
</tbody>
</table>

``` r
#歷次分數間相關
#程式報表10.4後
dta |> 
  dplyr::select(where(is.numeric)) |> 
  cor() |> 
  round(3)
```

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
月_03
</th>
<th style="text-align:right;">
月_06
</th>
<th style="text-align:right;">
月_12
</th>
<th style="text-align:right;">
月_18
</th>
<th style="text-align:right;">
月_24
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.483
</td>
<td style="text-align:right;">
0.328
</td>
<td style="text-align:right;">
0.252
</td>
<td style="text-align:right;">
0.177
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
0.483
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.438
</td>
<td style="text-align:right;">
0.351
</td>
<td style="text-align:right;">
0.248
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
0.328
</td>
<td style="text-align:right;">
0.438
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.525
</td>
<td style="text-align:right;">
0.396
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
0.252
</td>
<td style="text-align:right;">
0.351
</td>
<td style="text-align:right;">
0.525
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.579
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
0.177
</td>
<td style="text-align:right;">
0.248
</td>
<td style="text-align:right;">
0.396
</td>
<td style="text-align:right;">
0.579
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>

# 繪圖

``` r
#繪製不同母親教育程度五波圖
#圖10.1a
p1 <- ggplot(data = dtaL, 
       aes(x = 月, y = 記憶分數)) +
 ggbeeswarm::geom_quasirandom(aes(group=月), alpha=.1)+
 facet_wrap(vars(母親教育程度))+
 stat_summary(fun = mean, geom = 'line', linewidth=.8) +
 scale_x_continuous(breaks=c(3,6,12,18,24))+
 labs(x = '月齡', 
      y = '記憶能力分數') +
 theme(legend.position = 'top')
```

``` r
#看五波的機率密度函數圖
#圖10.1b
p2 <- ggplot(dtaL, 
       aes(x=記憶分數, y=月齡)) +
  ggridges::geom_density_ridges2()+
  scale_x_continuous(breaks=seq(10, 70, by=10))+
  facet_wrap(vars(母親教育程度))+
  labs(x = '記憶能力分數', 
       y = '月齡')
p1+p2
```

<img src="Ch10_files/figure-gfm/fig10_1-1.png" style="display: block; margin: auto;" />

``` r
#不同母親教育程度下的實徵累積機率密度圖
#圖10.2
ggplot(dtaL,
       aes(x=記憶分數, group=母親教育程度)) +
  stat_ecdf()+
  facet_wrap(vars(月齡))+
  labs(x="記憶能力分數",
       y="實徵累積機率密度")
```

<img src="Ch10_files/figure-gfm/fig10_2-1.png" style="display: block; margin: auto;" />

``` r
#看看個別資料，畫上迴歸線並配上區間
#圖10.3
ggplot(data = dtaL, 
       aes(y=記憶分數, x=月)) +
 geom_line(aes(group = 識別碼), 
           linewidth = .2,
           alpha=.5,
           col=8) +
 stat_summary(fun.data = 'mean_cl_boot', geom = "errorbar", width = 0.5) +
 stat_smooth(method="lm", 
             formula= y ~ poly(x, 2),
             se=FALSE, 
             col=1, 
             linewidth=.5)+
 facet_wrap(vars(母親教育程度))+
 scale_x_continuous(breaks=c(3, 6, 12, 18, 24))+
 scale_y_continuous(breaks=seq(8, 72, by=8))+
 labs(x = '月齡', 
      y = '記憶能力分數')
```

<img src="Ch10_files/figure-gfm/fig10_3-1.png" style="display: block; margin: auto;" />

``` r
#前述圖形看起來不完全是線性，後續進一步探索
#將資料框轉成 tsibble，方便後續使用
dta_tb <- brolgar::as_tsibble(x = dtaL,
                             key = 識別碼,
                             index = 月,
                             regular = FALSE)
```

``` r
#brolgar套件的features功能，可以計算每個幼兒記憶分數的五數綜合（含中位數）
#利用gghighlight，在繪圖時，特別強調中位數特別高或低的幼兒資料
#圖10.4
dta_tb |>
  brolgar::features(記憶分數, feat_five_num) |>
  dplyr::left_join(dta_tb, by = '識別碼') |>
  ggplot(aes(x = 月,
             y = 記憶分數,
             group = 識別碼)) +
  geom_line(linewidth=.2) + 
  gghighlight::gghighlight(med > 50 | med < 28, 
                           label_key = 識別碼,
                           use_direct_label = FALSE)+
   scale_x_continuous(breaks=c(3, 6, 12, 18, 24))+
  labs(x = '月齡', 
      y = '記憶能力分數')
```

<img src="Ch10_files/figure-gfm/fig10_4-1.png" style="display: block; margin: auto;" />

``` r
#brolgar套件中的facet_strata()，預設將資料分成12組，助於探索資料
#看看個別資料
#圖10.5
dta_tb |>
  ggplot(aes(x = 月,
             y = 記憶分數,
             group = 識別碼)) + 
  #geom_point()+
  geom_line(alpha=.2, linewidth=.2)+
  brolgar::facet_strata()+
  scale_x_continuous(breaks=c(3, 6, 12, 18, 24))
```

<img src="Ch10_files/figure-gfm/fig10_5-1.png" style="display: block; margin: auto;" />

``` r
#隨機取23位來看一下資料
#前面觀察到資料並非線性，嘗試以二次式迴歸配適資料
#為對比二次式，也用樣條迴歸（spline regression）配適資料
#圖10.6
set.seed(18072023)
dta |> dplyr::slice_sample(n=23) |>
  tidyr::pivot_longer(cols=3:7,
                      names_to ='月齡',  
                      values_to = '記憶分數') |>
  dplyr::mutate(月 = parse_number(月齡)) |>
  ggplot()+
  aes(x=月, y=記憶分數)+
  geom_point(pch=1, size=rel(3))+
  stat_smooth(method='lm', formula= y ~ poly(x, 2), 
              col=8,
              alpha=.5,
              linewidth=.6,
              se=FALSE)+
  stat_smooth(method='lm', 
         formula = y ~ splines::bs(x, knots = c(3, 12, 24), degree = 1),
              col=2,
              linetype='dotted',
              linewidth=1,
              se=FALSE)+
  facet_wrap(vars(識別碼)) +
  scale_x_continuous(breaks=c(3, 6, 12, 18, 24))+
  scale_y_continuous(breaks=seq(16, 72, by=16))+
  labs(x = '月齡', 
       y = '記憶能力分數',
       title="實灰:二次多項式, 點紅:樣條線性迴歸")
```

<img src="Ch10_files/figure-gfm/fig10_6-1.png" style="display: block; margin: auto;" />

## 二次多項式迴歸

``` r
#以nlme，做每個人的迴歸線
m1 <- nlme::lmList(記憶分數 ~ 月置中 + I(月置中^2) | 識別碼, data = dtaL, subset=母親教育程度=='專科以下') |> 
  coef() |> 
  as.data.frame() |>
  dplyr::mutate(母親教育程度='專科以下')

m2 <- nlme::lmList(記憶分數 ~ 月置中 + I(月置中^2) | 識別碼, data = dtaL, subset=母親教育程度=='大學以上') |> 
  coef() |> 
  as.data.frame() |>
  dplyr::mutate(母親教育程度='大學以上')

m12 <- rbind(m1, m2)
names(m12)[1:3] <- c("b0", "b1", "b2")
```

``` r
#截距、一次項與二次項係數間的相關
cor(m12[,-4])
```

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
b0
</th>
<th style="text-align:right;">
b1
</th>
<th style="text-align:right;">
b2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.4255
</td>
<td style="text-align:right;">
-0.6611
</td>
</tr>
<tr>
<td style="text-align:left;">
b1
</td>
<td style="text-align:right;">
0.4255
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0185
</td>
</tr>
<tr>
<td style="text-align:left;">
b2
</td>
<td style="text-align:right;">
-0.6611
</td>
<td style="text-align:right;">
0.0185
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
</tbody>
</table>

``` r
#看看母親教育程度對係數的影響
#程式報表10.5
m12 |> 
  gtsummary::tbl_summary(by=母親教育程度,
                         statistic = list(all_continuous() ~ "{mean} ({sd})"))
```

<div id="piviasaiav" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#piviasaiav table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
&#10;#piviasaiav thead, #piviasaiav tbody, #piviasaiav tfoot, #piviasaiav tr, #piviasaiav td, #piviasaiav th {
  border-style: none;
}
&#10;#piviasaiav p {
  margin: 0;
  padding: 0;
}
&#10;#piviasaiav .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}
&#10;#piviasaiav .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}
&#10;#piviasaiav .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}
&#10;#piviasaiav .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}
&#10;#piviasaiav .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#piviasaiav .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#piviasaiav .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#piviasaiav .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}
&#10;#piviasaiav .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}
&#10;#piviasaiav .gt_column_spanner_outer:first-child {
  padding-left: 0;
}
&#10;#piviasaiav .gt_column_spanner_outer:last-child {
  padding-right: 0;
}
&#10;#piviasaiav .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}
&#10;#piviasaiav .gt_spanner_row {
  border-bottom-style: hidden;
}
&#10;#piviasaiav .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}
&#10;#piviasaiav .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}
&#10;#piviasaiav .gt_from_md > :first-child {
  margin-top: 0;
}
&#10;#piviasaiav .gt_from_md > :last-child {
  margin-bottom: 0;
}
&#10;#piviasaiav .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}
&#10;#piviasaiav .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#piviasaiav .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}
&#10;#piviasaiav .gt_row_group_first td {
  border-top-width: 2px;
}
&#10;#piviasaiav .gt_row_group_first th {
  border-top-width: 2px;
}
&#10;#piviasaiav .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#piviasaiav .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}
&#10;#piviasaiav .gt_first_summary_row.thick {
  border-top-width: 2px;
}
&#10;#piviasaiav .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#piviasaiav .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#piviasaiav .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}
&#10;#piviasaiav .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}
&#10;#piviasaiav .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}
&#10;#piviasaiav .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#piviasaiav .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#piviasaiav .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#piviasaiav .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#piviasaiav .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#piviasaiav .gt_left {
  text-align: left;
}
&#10;#piviasaiav .gt_center {
  text-align: center;
}
&#10;#piviasaiav .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}
&#10;#piviasaiav .gt_font_normal {
  font-weight: normal;
}
&#10;#piviasaiav .gt_font_bold {
  font-weight: bold;
}
&#10;#piviasaiav .gt_font_italic {
  font-style: italic;
}
&#10;#piviasaiav .gt_super {
  font-size: 65%;
}
&#10;#piviasaiav .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}
&#10;#piviasaiav .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}
&#10;#piviasaiav .gt_indent_1 {
  text-indent: 5px;
}
&#10;#piviasaiav .gt_indent_2 {
  text-indent: 10px;
}
&#10;#piviasaiav .gt_indent_3 {
  text-indent: 15px;
}
&#10;#piviasaiav .gt_indent_4 {
  text-indent: 20px;
}
&#10;#piviasaiav .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    &#10;    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;大學以上&lt;/strong&gt;, N = 1,307&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>大學以上</strong>, N = 1,307<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;專科以下&lt;/strong&gt;, N = 693&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>專科以下</strong>, N = 693<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">b0</td>
<td headers="stat_1" class="gt_row gt_center">41.3 (3.9)</td>
<td headers="stat_2" class="gt_row gt_center">40.6 (4.3)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">b1</td>
<td headers="stat_1" class="gt_row gt_center">1.80 (0.26)</td>
<td headers="stat_2" class="gt_row gt_center">1.67 (0.26)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">b2</td>
<td headers="stat_1" class="gt_row gt_center">-0.05 (0.04)</td>
<td headers="stat_2" class="gt_row gt_center">-0.05 (0.04)</td></tr>
  </tbody>
  &#10;  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="3"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> Mean (SD)</td>
    </tr>
  </tfoot>
</table>
</div>

``` r
#不同母親教育程度所得之截距，線性斜率，二次項效果估計值
#圖10.7
g1<-ggplot(m12,
       aes(x=b0, y=b1, color=母親教育程度))+
  geom_point(pch=1)+
  stat_ellipse()+
  scale_color_grey()+
  labs(x='截距估計值', 
       y = '線性斜率估計值')+
  theme(legend.position='top')
g2<-ggplot(m12,
       aes(x=b1, y=b2, color=母親教育程度))+
  geom_point(pch=1)+
  stat_ellipse()+
  scale_color_grey()+
  labs(x='線性斜率估計值', 
       y = '二次項效果估計值')+
  theme(legend.position='top')
g3 <- ggplot(m12,
       aes(x=b0, y=b2, color=母親教育程度))+
  geom_point(pch=1)+
  stat_ellipse()+
  scale_color_grey()+
  labs(x='截距估計值', 
       y = '二次項效果估計值')+
  theme(legend.position='top')
g1 + g2 / g3
```

<img src="Ch10_files/figure-gfm/fig10_7-1.png" style="display: block; margin: auto;" />

# 潛在成長模型

## 先分析母親教育程度為大學以上者

``` r
#潛在成長模型可以視為因素分析的子模型，我們以 lavaan 進行分析
#先選擇母親教育程度為大學以上者分析
dta_2 <- dta |> dplyr::filter(母親教育程度 == '大學以上')
```

## 線性模型

``` r
#先試試看線性模型
growth1 <- '
intercept =~ 1*月_03 + 1*月_06 + 1*月_12 + 1*月_18 + 1*月_24
slope =~ 0*月_03 + 1*月_06 + 3*月_12 + 5*月_18 + 7*月_24
'
#配適模型
fit1 <- lavaan::growth(model = growth1, data = dta_2)
#程式報表10.6前，後
fit1 |> fitMeasures(c("chisq", "df", "pvalue", "rmsea","srmr","cfi", "tli"))
```

       chisq       df   pvalue    rmsea     srmr      cfi      tli 
    2039.065   10.000    0.000    0.394    0.352    0.000   -0.267 

``` r
fit1 |> parameterestimates() 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1.0000
</td>
<td style="text-align:right;">
1.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
3.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3.0000
</td>
<td style="text-align:right;">
3.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
5.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5.0000
</td>
<td style="text-align:right;">
5.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
7.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.0000
</td>
<td style="text-align:right;">
7.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.1163
</td>
<td style="text-align:right;">
0.2533
</td>
<td style="text-align:right;">
12.301
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
2.6198
</td>
<td style="text-align:right;">
3.6129
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
5.5443
</td>
<td style="text-align:right;">
0.2739
</td>
<td style="text-align:right;">
20.241
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
5.0075
</td>
<td style="text-align:right;">
6.0812
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
40.5503
</td>
<td style="text-align:right;">
1.6438
</td>
<td style="text-align:right;">
24.669
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
37.3285
</td>
<td style="text-align:right;">
43.7720
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
7.0278
</td>
<td style="text-align:right;">
0.5132
</td>
<td style="text-align:right;">
13.694
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
6.0219
</td>
<td style="text-align:right;">
8.0336
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
31.4282
</td>
<td style="text-align:right;">
1.5183
</td>
<td style="text-align:right;">
20.700
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
28.4524
</td>
<td style="text-align:right;">
34.4040
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
4.1679
</td>
<td style="text-align:right;">
0.2834
</td>
<td style="text-align:right;">
14.705
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
3.6124
</td>
<td style="text-align:right;">
4.7235
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
slope
</td>
<td style="text-align:right;">
0.3144
</td>
<td style="text-align:right;">
0.0261
</td>
<td style="text-align:right;">
12.024
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.2631
</td>
<td style="text-align:right;">
0.3656
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
slope
</td>
<td style="text-align:right;">
-0.2282
</td>
<td style="text-align:right;">
0.0644
</td>
<td style="text-align:right;">
-3.544
</td>
<td style="text-align:right;">
4e-04
</td>
<td style="text-align:right;">
-0.3545
</td>
<td style="text-align:right;">
-0.1020
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
20.4577
</td>
<td style="text-align:right;">
0.0701
</td>
<td style="text-align:right;">
291.897
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
20.3203
</td>
<td style="text-align:right;">
20.5950
</td>
</tr>
<tr>
<td style="text-align:left;">
slope
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
5.5142
</td>
<td style="text-align:right;">
0.0214
</td>
<td style="text-align:right;">
257.357
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
5.4722
</td>
<td style="text-align:right;">
5.5562
</td>
</tr>
</tbody>
</table>

## 二次多項式模型

``` r
#試試看二次模型

growth2 <- '
intercept =~ 1*月_03 + 1*月_06    + 1*月_12 + 1*月_18 +  1*月_24
linear =~ (-3)*月_03 + (-2)*月_06 + 0*月_12 + 2*月_18 +  4*月_24
qudratic =~  9*月_03 + 4*月_06    + 0*月_12 + 4*月_18 + 16*月_24
'
fit2 <- growth(model = growth2, data = dta_2)
```

    Warning in lav_object_post_check(object): lavaan WARNING: some estimated lv
    variances are negative

``` r
#程式報表10.7前
fit2 |> parameterestimates() |>
  filter(!is.na(z)) 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.4138
</td>
<td style="text-align:right;">
0.4015
</td>
<td style="text-align:right;">
8.5035
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
2.6269
</td>
<td style="text-align:right;">
4.2006
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
8.9889
</td>
<td style="text-align:right;">
0.4166
</td>
<td style="text-align:right;">
21.5760
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
8.1723
</td>
<td style="text-align:right;">
9.8054
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
23.1927
</td>
<td style="text-align:right;">
0.9902
</td>
<td style="text-align:right;">
23.4226
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
21.2520
</td>
<td style="text-align:right;">
25.1335
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
4.6782
</td>
<td style="text-align:right;">
0.4845
</td>
<td style="text-align:right;">
9.6562
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
3.7286
</td>
<td style="text-align:right;">
5.6277
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
22.6209
</td>
<td style="text-align:right;">
1.7112
</td>
<td style="text-align:right;">
13.2194
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
19.2670
</td>
<td style="text-align:right;">
25.9748
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
6.9909
</td>
<td style="text-align:right;">
0.5519
</td>
<td style="text-align:right;">
12.6672
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
5.9092
</td>
<td style="text-align:right;">
8.0726
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
0.3478
</td>
<td style="text-align:right;">
0.0260
</td>
<td style="text-align:right;">
13.4004
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.2969
</td>
<td style="text-align:right;">
0.3986
</td>
</tr>
<tr>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:right;">
-0.0139
</td>
<td style="text-align:right;">
0.0058
</td>
<td style="text-align:right;">
-2.3825
</td>
<td style="text-align:right;">
0.0172
</td>
<td style="text-align:right;">
-0.0253
</td>
<td style="text-align:right;">
-0.0025
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
1.1746
</td>
<td style="text-align:right;">
0.0998
</td>
<td style="text-align:right;">
11.7751
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.9791
</td>
<td style="text-align:right;">
1.3702
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:right;">
-0.0202
</td>
<td style="text-align:right;">
0.0424
</td>
<td style="text-align:right;">
-0.4769
</td>
<td style="text-align:right;">
0.6334
</td>
<td style="text-align:right;">
-0.1033
</td>
<td style="text-align:right;">
0.0629
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:right;">
-0.0420
</td>
<td style="text-align:right;">
0.0099
</td>
<td style="text-align:right;">
-4.2283
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
-0.0615
</td>
<td style="text-align:right;">
-0.0226
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
39.1876
</td>
<td style="text-align:right;">
0.0993
</td>
<td style="text-align:right;">
394.5548
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
38.9929
</td>
<td style="text-align:right;">
39.3823
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
5.4303
</td>
<td style="text-align:right;">
0.0212
</td>
<td style="text-align:right;">
256.3939
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
5.3888
</td>
<td style="text-align:right;">
5.4718
</td>
</tr>
<tr>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
-0.3119
</td>
<td style="text-align:right;">
0.0084
</td>
<td style="text-align:right;">
-37.1707
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
-0.3284
</td>
<td style="text-align:right;">
-0.2955
</td>
</tr>
</tbody>
</table>

``` r
#修改二次模型，要求二次參數變異數為小的正數
#程式報表10.10後
growth21 <- '
intercept =~ 1*月_03 + 1*月_06    + 1*月_12 + 1*月_18 +  1*月_24
linear =~ (-3)*月_03 + (-2)*月_06 + 0*月_12 + 2*月_18 +  4*月_24
qudratic =~  9*月_03 + 4*月_06    + 0*月_12 + 4*月_18 + 16*月_24
qudratic~~.01*qudratic
'
fit21 <- growth(model = growth21, data = dta_2)
#程式報表10.7中，後
fit21 |> fitMeasures(c("chisq", "df", "pvalue", "rmsea","srmr","cfi", "tli"))
```

       chisq       df   pvalue    rmsea     srmr      cfi      tli 
    1191.427    7.000    0.000    0.360    0.217    0.260   -0.057 

``` r
fit21 |> parameterestimates() |>
  filter(!is.na(z)) 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.0453
</td>
<td style="text-align:right;">
0.3832
</td>
<td style="text-align:right;">
7.947
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
2.2942
</td>
<td style="text-align:right;">
3.7963
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
8.8895
</td>
<td style="text-align:right;">
0.4124
</td>
<td style="text-align:right;">
21.555
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
8.0812
</td>
<td style="text-align:right;">
9.6977
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
22.4378
</td>
<td style="text-align:right;">
0.9550
</td>
<td style="text-align:right;">
23.496
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
20.5661
</td>
<td style="text-align:right;">
24.3095
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
4.8065
</td>
<td style="text-align:right;">
0.4760
</td>
<td style="text-align:right;">
10.099
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
3.8737
</td>
<td style="text-align:right;">
5.7394
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
17.6857
</td>
<td style="text-align:right;">
1.2196
</td>
<td style="text-align:right;">
14.501
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
15.2953
</td>
<td style="text-align:right;">
20.0761
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
7.7949
</td>
<td style="text-align:right;">
0.5302
</td>
<td style="text-align:right;">
14.703
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
6.7559
</td>
<td style="text-align:right;">
8.8340
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
0.3694
</td>
<td style="text-align:right;">
0.0250
</td>
<td style="text-align:right;">
14.761
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.3204
</td>
<td style="text-align:right;">
0.4185
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
1.0969
</td>
<td style="text-align:right;">
0.0986
</td>
<td style="text-align:right;">
11.127
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.9037
</td>
<td style="text-align:right;">
1.2901
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:right;">
-0.1533
</td>
<td style="text-align:right;">
0.0287
</td>
<td style="text-align:right;">
-5.339
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
-0.2096
</td>
<td style="text-align:right;">
-0.0970
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:right;">
-0.0300
</td>
<td style="text-align:right;">
0.0100
</td>
<td style="text-align:right;">
-2.998
</td>
<td style="text-align:right;">
0.0027
</td>
<td style="text-align:right;">
-0.0496
</td>
<td style="text-align:right;">
-0.0104
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
39.2071
</td>
<td style="text-align:right;">
0.1015
</td>
<td style="text-align:right;">
386.430
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
39.0082
</td>
<td style="text-align:right;">
39.4060
</td>
</tr>
<tr>
<td style="text-align:left;">
linear
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
5.4253
</td>
<td style="text-align:right;">
0.0211
</td>
<td style="text-align:right;">
256.864
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
5.3839
</td>
<td style="text-align:right;">
5.4667
</td>
</tr>
<tr>
<td style="text-align:left;">
qudratic
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
-0.3126
</td>
<td style="text-align:right;">
0.0088
</td>
<td style="text-align:right;">
-35.390
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
-0.3299
</td>
<td style="text-align:right;">
-0.2953
</td>
</tr>
</tbody>
</table>

``` r
#線性模型與二次模型比較
#程式報表10.8
anova(fit1, fit21)
```

<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Df
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
BIC
</th>
<th style="text-align:right;">
Chisq
</th>
<th style="text-align:right;">
Chisq diff
</th>
<th style="text-align:right;">
RMSEA
</th>
<th style="text-align:right;">
Df diff
</th>
<th style="text-align:right;">
Pr(\>Chisq)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fit21
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
36091
</td>
<td style="text-align:right;">
36158
</td>
<td style="text-align:right;">
1191
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
fit1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
36933
</td>
<td style="text-align:right;">
36984
</td>
<td style="text-align:right;">
2039
</td>
<td style="text-align:right;">
847.6
</td>
<td style="text-align:right;">
0.4641
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>

## 包含形狀因素不固定的潛在成長模型

``` r
#包含形狀因素的潛在成長模型，形狀不固定
growth3 <- '
intercept =~ 1*月_03 + 1*月_06 + 1*月_12 + 1*月_18 + 1*月_24
shape =~     0*月_03 + 月_06   +   月_12 + 月_18   + 1*月_24
'
fit3 <- growth(model = growth3, data = dta_2)
#程式報表10.9前，後
fit3 |> fitMeasures(c("chisq", "df", "pvalue", "rmsea","srmr","cfi", "tli"))
```

     chisq     df pvalue  rmsea   srmr    cfi    tli 
    60.079  7.000  0.000  0.076  0.045  0.967  0.953 

``` r
fit3 |> parameterestimates() |>
  filter(!is.na(z)) 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
0.1405
</td>
<td style="text-align:right;">
0.0022
</td>
<td style="text-align:right;">
65.114
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.1363
</td>
<td style="text-align:right;">
0.1448
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
0.6066
</td>
<td style="text-align:right;">
0.0036
</td>
<td style="text-align:right;">
168.957
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.5995
</td>
<td style="text-align:right;">
0.6136
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
0.7974
</td>
<td style="text-align:right;">
0.0032
</td>
<td style="text-align:right;">
245.741
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
0.7910
</td>
<td style="text-align:right;">
0.8038
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.1535
</td>
<td style="text-align:right;">
0.2450
</td>
<td style="text-align:right;">
12.873
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
2.6734
</td>
<td style="text-align:right;">
3.6337
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
4.9861
</td>
<td style="text-align:right;">
0.2506
</td>
<td style="text-align:right;">
19.893
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
4.4948
</td>
<td style="text-align:right;">
5.4773
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
13.9670
</td>
<td style="text-align:right;">
0.6157
</td>
<td style="text-align:right;">
22.686
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
12.7604
</td>
<td style="text-align:right;">
15.1737
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
5.4090
</td>
<td style="text-align:right;">
0.3997
</td>
<td style="text-align:right;">
13.532
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
4.6256
</td>
<td style="text-align:right;">
6.1925
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
18.5165
</td>
<td style="text-align:right;">
0.9268
</td>
<td style="text-align:right;">
19.979
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
16.7000
</td>
<td style="text-align:right;">
20.3330
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
4.2694
</td>
<td style="text-align:right;">
0.2780
</td>
<td style="text-align:right;">
15.356
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
3.7245
</td>
<td style="text-align:right;">
4.8143
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
15.2976
</td>
<td style="text-align:right;">
1.0050
</td>
<td style="text-align:right;">
15.222
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
13.3279
</td>
<td style="text-align:right;">
17.2674
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
-1.4559
</td>
<td style="text-align:right;">
0.3996
</td>
<td style="text-align:right;">
-3.644
</td>
<td style="text-align:right;">
3e-04
</td>
<td style="text-align:right;">
-2.2391
</td>
<td style="text-align:right;">
-0.6728
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
20.4325
</td>
<td style="text-align:right;">
0.0753
</td>
<td style="text-align:right;">
271.236
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
20.2848
</td>
<td style="text-align:right;">
20.5801
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
35.4099
</td>
<td style="text-align:right;">
0.1681
</td>
<td style="text-align:right;">
210.690
</td>
<td style="text-align:right;">
0e+00
</td>
<td style="text-align:right;">
35.0805
</td>
<td style="text-align:right;">
35.7393
</td>
</tr>
</tbody>
</table>

``` r
#程式報表10.10
semTools::compareFit(linear = fit1, quadratic = fit21, shape = fit3, nested=F) |> summary()
```

    ####################### Model Fit Indices ###########################
                  chisq df pvalue rmsea   cfi     tli  srmr        aic        bic
    quadratic 1191.427   7   .000 .360  .260  -0.057  .217  36090.998  36158.280 
    shape       60.079†  7   .000 .076† .967†   .953† .045† 34959.650† 35026.931†
    linear    2039.065  10   .000 .394  .000  -0.267  .352  36932.636  36984.391 

``` r
#繪製路徑圖
#將圖存為 .png
#圖10.8
pl_01 <- lavaanPlot(model=fit3,
           edge_options = list(color = "grey"),
           coefs = TRUE,
           stand = FALSE,
           covs = TRUE)
dir.create(file.path(here::here()), 'figure')
lavaanPlot::save_png(pl_01, "figure/plot_01.png")
```

``` r
knitr::include_graphics("figure/plot_01.png")
```

<img src="figure/plot_01.png" width="397" style="display: block; margin: auto;" />

## 包括共變量的潛在成長模型

``` r
#我們選擇包含形狀因素的潛在成長模型
#進一步看看母親教育程度對截距與形狀的影響。
#先看看不同母親教育程度下，資料配適情形。
dta_1 <- dta |> 
  dplyr::filter(母親教育程度 == '專科以下')
```

``` r
fit32 <- growth(model = growth3, data=dta_1)
#程式報表10.11前，後
fit32 |> fitMeasures(c("chisq", "df", "pvalue", "rmsea","srmr","cfi", "tli"))
```

     chisq     df pvalue  rmsea   srmr    cfi    tli 
    24.619  7.000  0.001  0.060  0.041  0.980  0.972 

``` r
fit32 |> parameterestimates() |>
  filter(!is.na(z)) 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
0.1559
</td>
<td style="text-align:right;">
0.0033
</td>
<td style="text-align:right;">
47.675
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.1495
</td>
<td style="text-align:right;">
0.1624
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
0.6417
</td>
<td style="text-align:right;">
0.0059
</td>
<td style="text-align:right;">
109.625
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.6302
</td>
<td style="text-align:right;">
0.6531
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
0.8302
</td>
<td style="text-align:right;">
0.0050
</td>
<td style="text-align:right;">
165.500
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.8203
</td>
<td style="text-align:right;">
0.8400
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.2822
</td>
<td style="text-align:right;">
0.3500
</td>
<td style="text-align:right;">
9.379
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
2.5963
</td>
<td style="text-align:right;">
3.9681
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
5.0796
</td>
<td style="text-align:right;">
0.3524
</td>
<td style="text-align:right;">
14.415
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
4.3889
</td>
<td style="text-align:right;">
5.7703
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
18.0393
</td>
<td style="text-align:right;">
1.0802
</td>
<td style="text-align:right;">
16.700
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
15.9222
</td>
<td style="text-align:right;">
20.1565
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
7.2380
</td>
<td style="text-align:right;">
0.6609
</td>
<td style="text-align:right;">
10.952
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
5.9427
</td>
<td style="text-align:right;">
8.5334
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
15.8757
</td>
<td style="text-align:right;">
1.1730
</td>
<td style="text-align:right;">
13.534
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
13.5766
</td>
<td style="text-align:right;">
18.1748
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
4.4440
</td>
<td style="text-align:right;">
0.3991
</td>
<td style="text-align:right;">
11.134
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
3.6617
</td>
<td style="text-align:right;">
5.2262
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
15.6778
</td>
<td style="text-align:right;">
1.4137
</td>
<td style="text-align:right;">
11.090
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
12.9070
</td>
<td style="text-align:right;">
18.4485
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
-0.8501
</td>
<td style="text-align:right;">
0.5604
</td>
<td style="text-align:right;">
-1.517
</td>
<td style="text-align:right;">
0.1293
</td>
<td style="text-align:right;">
-1.9485
</td>
<td style="text-align:right;">
0.2483
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
20.3867
</td>
<td style="text-align:right;">
0.1055
</td>
<td style="text-align:right;">
193.177
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
20.1799
</td>
<td style="text-align:right;">
20.5936
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
32.3128
</td>
<td style="text-align:right;">
0.2241
</td>
<td style="text-align:right;">
144.212
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
31.8736
</td>
<td style="text-align:right;">
32.7520
</td>
</tr>
</tbody>
</table>

``` r
#將母親教育程度變成 0,1 的虛擬變項
dta <- dta |> 
  dplyr::mutate(母親大學以上 = ifelse(母親教育程度 =='大學以上', 1 , 0))
```

## 包含形狀因素的潛在成長模型

``` r
#包含形狀因素的潛在成長模型，讓性別影響截距與形狀因素。
growth4 <- '
intercept =~ 1*月_03 + 1*月_06 + 1*月_12 + 1*月_18 + 1*月_24
shape =~     0*月_03 + 月_06   + 月_12  + 月_18   + 1*月_24
intercept ~ 母親大學以上
shape ~ 母親大學以上
'
fit4 <- growth(model = growth4, data = dta, fixed.x = T)
#程式報表10.12前，後
fit4 |> fitMeasures(c("chisq", "df", "pvalue", "rmsea","srmr","cfi", "tli"))
```

      chisq      df  pvalue   rmsea    srmr     cfi     tli 
    125.850  10.000   0.000   0.076   0.040   0.957   0.935 

``` r
fit4 |> parameterestimates() |>
  filter(!is.na(z)) 
```

<table>
<thead>
<tr>
<th style="text-align:left;">
lhs
</th>
<th style="text-align:left;">
op
</th>
<th style="text-align:left;">
rhs
</th>
<th style="text-align:right;">
est
</th>
<th style="text-align:right;">
se
</th>
<th style="text-align:right;">
z
</th>
<th style="text-align:right;">
pvalue
</th>
<th style="text-align:right;">
ci.lower
</th>
<th style="text-align:right;">
ci.upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
0.1453
</td>
<td style="text-align:right;">
0.0018
</td>
<td style="text-align:right;">
80.435
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.1418
</td>
<td style="text-align:right;">
0.1489
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
0.6176
</td>
<td style="text-align:right;">
0.0031
</td>
<td style="text-align:right;">
199.605
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.6115
</td>
<td style="text-align:right;">
0.6236
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
=~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
0.8077
</td>
<td style="text-align:right;">
0.0027
</td>
<td style="text-align:right;">
293.860
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.8023
</td>
<td style="text-align:right;">
0.8130
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~
</td>
<td style="text-align:left;">
母親大學以上
</td>
<td style="text-align:right;">
-0.1331
</td>
<td style="text-align:right;">
0.1202
</td>
<td style="text-align:right;">
-1.107
</td>
<td style="text-align:right;">
0.2683
</td>
<td style="text-align:right;">
-0.3687
</td>
<td style="text-align:right;">
0.1026
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
~
</td>
<td style="text-align:left;">
母親大學以上
</td>
<td style="text-align:right;">
2.2623
</td>
<td style="text-align:right;">
0.2330
</td>
<td style="text-align:right;">
9.709
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
1.8056
</td>
<td style="text-align:right;">
2.7190
</td>
</tr>
<tr>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_03
</td>
<td style="text-align:right;">
3.2297
</td>
<td style="text-align:right;">
0.2015
</td>
<td style="text-align:right;">
16.027
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
2.8348
</td>
<td style="text-align:right;">
3.6247
</td>
</tr>
<tr>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_06
</td>
<td style="text-align:right;">
5.0261
</td>
<td style="text-align:right;">
0.2047
</td>
<td style="text-align:right;">
24.552
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
4.6249
</td>
<td style="text-align:right;">
5.4273
</td>
</tr>
<tr>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_12
</td>
<td style="text-align:right;">
15.4539
</td>
<td style="text-align:right;">
0.5485
</td>
<td style="text-align:right;">
28.174
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
14.3789
</td>
<td style="text-align:right;">
16.5290
</td>
</tr>
<tr>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_18
</td>
<td style="text-align:right;">
6.0735
</td>
<td style="text-align:right;">
0.3485
</td>
<td style="text-align:right;">
17.430
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
5.3906
</td>
<td style="text-align:right;">
6.7565
</td>
</tr>
<tr>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
月_24
</td>
<td style="text-align:right;">
17.9492
</td>
<td style="text-align:right;">
0.7409
</td>
<td style="text-align:right;">
24.227
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
16.4971
</td>
<td style="text-align:right;">
19.4013
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:right;">
4.3130
</td>
<td style="text-align:right;">
0.2282
</td>
<td style="text-align:right;">
18.897
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
3.8657
</td>
<td style="text-align:right;">
4.7604
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
15.3526
</td>
<td style="text-align:right;">
0.8222
</td>
<td style="text-align:right;">
18.672
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
13.7411
</td>
<td style="text-align:right;">
16.9642
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
\~~
</td>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
-1.2111
</td>
<td style="text-align:right;">
0.3257
</td>
<td style="text-align:right;">
-3.718
</td>
<td style="text-align:right;">
0.0002
</td>
<td style="text-align:right;">
-1.8494
</td>
<td style="text-align:right;">
-0.5727
</td>
</tr>
<tr>
<td style="text-align:left;">
intercept
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
20.5061
</td>
<td style="text-align:right;">
0.0995
</td>
<td style="text-align:right;">
206.120
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
20.3111
</td>
<td style="text-align:right;">
20.7011
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:left;">
~1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
32.8697
</td>
<td style="text-align:right;">
0.2023
</td>
<td style="text-align:right;">
162.507
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
32.4733
</td>
<td style="text-align:right;">
33.2662
</td>
</tr>
</tbody>
</table>

## 比較實際記憶分數平均與預測值平均

``` r
#比較實際資料與預測值平均
#計算實際平均數
df <- aggregate(cbind(月_03, 月_06, 月_12, 月_18, 月_24) ~ 母親教育程度, 
                data = dta, mean) |>
  tidyr::pivot_longer(cols=-1, 
                      names_to = "月", 
                      values_to = '記憶分數平均') |>
  dplyr::mutate(月 = parse_number(月))
#計算預測值
t <- c(0,.145, .618, .808, 1)
df$估計值平均 <- c((20.506-.133)+(32.870+2.262)*t, 20.506+32.870*t)
```

``` r
#畫圖
#圖10.9
df |> tidyr::pivot_longer(cols=3:4,
                      names_to = "估計",
                      values_to = "平均分數") |>
 ggplot()+
   aes(y=平均分數, x=月, group=估計, color=估計)+
   geom_point(size=rel(5), pch=1)+
   geom_line(linewidth=.4)+
   facet_wrap(vars(母親教育程度))+
   scale_color_grey(end=.6)+
   scale_x_continuous(breaks=c(3, 6, 12, 18, 24))+
   labs(x = '月齡',
        y = '記憶能力平均分數')+
   theme(legend.position='top')
```

<img src="Ch10_files/figure-gfm/fig10_9-1.png" style="display: block; margin: auto;" />

``` r
#繪製路徑圖
#將圖存為 .png
#圖10.10
pl_02 <- lavaanPlot(model=fit4,
           edge_options = list(color = "grey"),
           coefs = TRUE,
           stand = FALSE,
           covs = TRUE)
dir.create(file.path(here::here()), 'figure')
lavaanPlot::save_png(pl_02, "figure/plot_02.png")
```

``` r
knitr::include_graphics("figure/plot_02.png")
```

<img src="figure/plot_02.png" width="427" style="display: block; margin: auto;" />
